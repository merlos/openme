<Window x:Class="openme_windows.Views.ProfileManagerWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        Title="openme â€” Manage Profiles"
        Width="680" Height="500"
        MinWidth="560" MinHeight="400"
        WindowStartupLocation="CenterScreen"
        ResizeMode="CanResize">

    <Grid>
        <Grid.ColumnDefinitions>
            <ColumnDefinition Width="180" MinWidth="140"/>
            <ColumnDefinition Width="4"/>
            <ColumnDefinition Width="*"/>
        </Grid.ColumnDefinitions>

        <!-- â”€â”€ Left: profile list â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ -->
        <DockPanel Grid.Column="0" LastChildFill="True">
            <!-- Toolbar: delete -->
            <Border DockPanel.Dock="Bottom"
                    BorderBrush="#DDDDDD" BorderThickness="0,1,0,0"
                    Background="#F8F8F8" Padding="6">
                <StackPanel Orientation="Horizontal">
                    <Button Content="â€“" Width="28" Height="24"
                            ToolTip="Remove selected profile"
                            IsEnabled="{Binding HasSelection}"
                            Click="DeleteButton_Click"
                            Style="{StaticResource DangerButton}"/>
                </StackPanel>
            </Border>

            <ListBox x:Name="ProfileListBox"
                     ItemsSource="{Binding Profiles}"
                     SelectedItem="{Binding SelectedEntry, Mode=TwoWay}"
                     BorderThickness="0"
                     Background="White">
                <ListBox.ItemTemplate>
                    <DataTemplate>
                        <StackPanel Margin="0,2">
                            <TextBlock Text="{Binding Name}" FontWeight="SemiBold"/>
                            <TextBlock FontSize="11" Foreground="#777777">
                                <Run Text="{Binding ServerHost}"/>
                                <Run Text=":"/>
                                <Run Text="{Binding ServerUdpPort}"/>
                            </TextBlock>
                        </StackPanel>
                    </DataTemplate>
                </ListBox.ItemTemplate>
            </ListBox>
        </DockPanel>

        <!-- â”€â”€ Splitter â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ -->
        <GridSplitter Grid.Column="1" Width="4"
                      HorizontalAlignment="Stretch" VerticalAlignment="Stretch"
                      Background="#E0E0E0"/>

        <!-- â”€â”€ Right: detail / empty state â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ -->
        <Grid Grid.Column="2">

            <!-- No selection placeholder -->
            <StackPanel VerticalAlignment="Center" HorizontalAlignment="Center"
                        Visibility="{Binding IsEditing, Converter={StaticResource BoolToVisibilityInverter}}">
                <TextBlock Text="ðŸ”’" FontSize="40" HorizontalAlignment="Center"/>
                <TextBlock Text="Select a profile"
                           Foreground="#999999" HorizontalAlignment="Center" Margin="0,8,0,0"/>
            </StackPanel>

            <!-- Profile edit form -->
            <Grid Visibility="{Binding IsEditing, Converter={StaticResource BoolToVisibility}}">
                <Grid.RowDefinitions>
                    <RowDefinition Height="*"/>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="Auto"/>
                </Grid.RowDefinitions>

                <ScrollViewer Grid.Row="0" VerticalScrollBarVisibility="Auto">
                    <StackPanel Margin="20,16,20,0" DataContext="{Binding EditingProfile}">

                        <!-- Server section -->
                        <TextBlock Style="{StaticResource SectionLabel}" Text="SERVER"/>
                        <Border BorderBrush="#DDDDDD" BorderThickness="1" CornerRadius="4"
                                Padding="12" Margin="0,0,0,16">
                            <StackPanel>
                                <TextBlock Style="{StaticResource FieldLabel}" Text="Profile name"/>
                                <TextBox x:Name="NameBox" Text="{Binding Name, UpdateSourceTrigger=PropertyChanged}"/>
                                <TextBlock Style="{StaticResource HintText}" Text="Unique name for this profile" Margin="0,0,0,10"/>

                                <TextBlock Style="{StaticResource FieldLabel}" Text="Host"/>
                                <TextBox Text="{Binding ServerHost, UpdateSourceTrigger=PropertyChanged}"/>
                                <TextBlock Style="{StaticResource HintText}" Text="Hostname or IP address" Margin="0,0,0,10"/>

                                <TextBlock Style="{StaticResource FieldLabel}" Text="UDP Port"/>
                                <TextBox Text="{Binding ServerUdpPort, UpdateSourceTrigger=PropertyChanged}" Width="100" HorizontalAlignment="Left"/>
                                <TextBlock Style="{StaticResource HintText}" Text="Default: 54154" Margin="0,0,0,10"/>

                                <TextBlock Style="{StaticResource FieldLabel}" Text="Server public key (base64 Curve25519)"/>
                                <TextBox Text="{Binding ServerPubKey, UpdateSourceTrigger=PropertyChanged}"
                                         FontFamily="Consolas" FontSize="11"/>
                            </StackPanel>
                        </Border>

                        <!-- Client keys section -->
                        <TextBlock Style="{StaticResource SectionLabel}" Text="CLIENT KEYS"/>
                        <Border BorderBrush="#DDDDDD" BorderThickness="1" CornerRadius="4"
                                Padding="12" Margin="0,0,0,16">
                            <StackPanel>
                                <TextBlock Style="{StaticResource FieldLabel}" Text="Private key (base64 Ed25519)"/>
                                <Grid>
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="*"/>
                                        <ColumnDefinition Width="Auto"/>
                                    </Grid.ColumnDefinitions>
                                    <PasswordBox x:Name="PrivKeyBox" Grid.Column="0"
                                                 FontFamily="Consolas" FontSize="11"
                                                 PasswordChanged="PrivKeyBox_PasswordChanged"/>
                                    <TextBox x:Name="PrivKeyPlainBox" Grid.Column="0"
                                             Text="{Binding PrivateKey, UpdateSourceTrigger=PropertyChanged}"
                                             FontFamily="Consolas" FontSize="11"
                                             Visibility="Collapsed"/>
                                    <ToggleButton x:Name="ShowPrivKey" Grid.Column="1"
                                                  Content="Show" Width="50" Margin="4,0,0,0"
                                                  Checked="ShowPrivKey_Checked"
                                                  Unchecked="ShowPrivKey_Unchecked"/>
                                </Grid>
                                <TextBlock Style="{StaticResource HintText}" Text="32-byte or 64-byte seed" Margin="0,0,0,10"/>

                                <TextBlock Style="{StaticResource FieldLabel}" Text="Public key (base64 Ed25519)"/>
                                <TextBox Text="{Binding PublicKey, UpdateSourceTrigger=PropertyChanged}"
                                         FontFamily="Consolas" FontSize="11"/>
                            </StackPanel>
                        </Border>

                        <!-- Post-knock section -->
                        <TextBlock Style="{StaticResource SectionLabel}" Text="POST-KNOCK"/>
                        <Border BorderBrush="#DDDDDD" BorderThickness="1" CornerRadius="4"
                                Padding="12" Margin="0,0,0,20">
                            <StackPanel>
                                <TextBlock Style="{StaticResource FieldLabel}" Text="Shell command (optional)"/>
                                <TextBox Text="{Binding PostKnock, UpdateSourceTrigger=PropertyChanged}"
                                         FontFamily="Consolas" FontSize="11"/>
                                <TextBlock Style="{StaticResource HintText}"
                                           Text="Run after a successful knock. Example: start ssh://server.example.com"/>
                            </StackPanel>
                        </Border>
                    </StackPanel>
                </ScrollViewer>

                <!-- Error message -->
                <TextBlock Grid.Row="1"
                           Text="{Binding ErrorMessage}" Foreground="Red"
                           FontSize="11" Margin="20,4,20,4"
                           Visibility="{Binding ErrorMessage, Converter={StaticResource NullToVisibility}}"/>

                <!-- Feedback (knock status / save confirmation) -->
                <TextBlock Grid.Row="1"
                           Text="{Binding FeedbackMessage}" Foreground="#2A7A2A"
                           FontSize="11" Margin="20,4,20,4"
                           Visibility="{Binding FeedbackMessage, Converter={StaticResource NullToVisibility}}"/>

                <!-- Footer buttons -->
                <Border Grid.Row="2"
                        BorderBrush="#DDDDDD" BorderThickness="0,1,0,0"
                        Background="#F8F8F8" Padding="16,10">
                    <DockPanel LastChildFill="False">
                        <!-- Knock actions (left side) -->
                        <StackPanel DockPanel.Dock="Left" Orientation="Horizontal">
                            <Button Content="Knock" Width="80"
                                    IsEnabled="{Binding HasSelection}"
                                    Click="KnockButton_Click"
                                    Style="{StaticResource PrimaryButton}"/>
                            <Button Margin="8,0,0,0" Width="160"
                                    IsEnabled="{Binding HasSelection}"
                                    Click="ContinuousKnockButton_Click"
                                    Style="{StaticResource SecondaryButton}">
                                <Button.Content>
                                    <TextBlock>
                                        <TextBlock.Style>
                                            <Style TargetType="TextBlock">
                                                <Setter Property="Text" Value="Start Continuous Knock"/>
                                                <Style.Triggers>
                                                    <DataTrigger Binding="{Binding IsContinuousKnocking}" Value="True">
                                                        <Setter Property="Text" Value="Stop Continuous Knock"/>
                                                    </DataTrigger>
                                                </Style.Triggers>
                                            </Style>
                                        </TextBlock.Style>
                                    </TextBlock>
                                </Button.Content>
                            </Button>
                        </StackPanel>

                        <!-- Save (right side) -->
                        <Button DockPanel.Dock="Right" Content="Save"
                                Width="80" IsEnabled="{Binding IsEditing}"
                                Click="SaveButton_Click"
                                Style="{StaticResource PrimaryButton}"/>
                    </DockPanel>
                </Border>
            </Grid>
        </Grid>
    </Grid>
</Window>
